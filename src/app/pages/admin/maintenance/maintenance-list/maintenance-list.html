<div class="max-w-7xl mx-auto p-8 font-sans bg-white min-h-screen">

    <!-- Title & Controls -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Maintenance Schedule</h1>
            <p class="text-sm text-gray-500 mt-1">Manage preventive maintenance orders and timelines.</p>
        </div>
        <div class="flex items-center gap-3">
            <button (click)="generateTickets()" [disabled]="generating"
                class="flex items-center gap-2 px-5 py-2.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold shadow-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                <svg *ngIf="!generating" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                    stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                    <path d="M21 12V7l-8-4-8 4v5"></path>
                    <path d="M3 7l18 0"></path>
                    <path d="M12 3v13"></path>
                    <circle cx="12" cy="19" r="3"></circle>
                </svg>
                <div *ngIf="generating"
                    class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                <span>{{ generating ? 'Generating...' : 'Auto-Generate (7 Days)' }}</span>
            </button>
        </div>
    </div>

    <!-- Filters & View Switcher -->
    <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-6 border-b border-gray-100 pb-6">

        <!-- Tabs -->
        <div class="flex p-1 bg-gray-50 rounded-lg border border-gray-100">
            <button (click)="setTab('upcoming')" class="px-4 py-1.5 text-xs font-bold rounded-md transition-all"
                [ngClass]="activeTab === 'upcoming' ? 'bg-white text-gray-900 shadow-sm border border-gray-200' : 'text-gray-500 hover:text-gray-700'">
                Upcoming
            </button>
            <button (click)="setTab('history')" class="px-4 py-1.5 text-xs font-bold rounded-md transition-all"
                [ngClass]="activeTab === 'history' ? 'bg-white text-gray-900 shadow-sm border border-gray-200' : 'text-gray-500 hover:text-gray-700'">
                History
            </button>
            <button (click)="setTab('all')" class="px-4 py-1.5 text-xs font-bold rounded-md transition-all"
                [ngClass]="activeTab === 'all' ? 'bg-white text-gray-900 shadow-sm border border-gray-200' : 'text-gray-500 hover:text-gray-700'">
                All
            </button>
        </div>

        <!-- View Switcher -->
        <div class="flex items-center gap-2">
            <span class="text-xs font-bold text-gray-400 uppercase tracking-wider mr-2">View Mode:</span>
            <div class="flex p-1 bg-gray-50 rounded-lg border border-gray-100">
                <button (click)="setViewMode('list')" class="p-1.5 rounded-md transition-all"
                    [ngClass]="viewMode === 'list' ? 'bg-white text-blue-600 shadow-sm border border-gray-200' : 'text-gray-400 hover:text-gray-600'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                        stroke-width="2" viewBox="0 0 24 24">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                </button>
                <button (click)="setViewMode('timeline')" class="p-1.5 rounded-md transition-all"
                    [ngClass]="viewMode === 'timeline' ? 'bg-white text-blue-600 shadow-sm border border-gray-200' : 'text-gray-400 hover:text-gray-600'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                        stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 20V10"></path>
                        <path d="M18 20V4"></path>
                        <path d="M6 20v-4"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-20 text-gray-400">
        <div class="w-8 h-8 border-2 border-gray-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
        <p class="text-xs font-bold uppercase tracking-widest">Loading Schedule...</p>
    </div>



    <!-- Empty State -->
    <div *ngIf="!loading && schedules.length === 0"
        class="text-center py-20 border border-dashed border-gray-200 rounded-xl bg-gray-50/50">
        <div
            class="w-12 h-12 bg-white rounded-xl flex items-center justify-center mx-auto mb-4 text-gray-400 shadow-sm border border-gray-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
                stroke-width="2" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </div>
        <h3 class="text-sm font-bold text-gray-900">No Schedules Found</h3>
        <p class="text-xs text-gray-500 mt-1">Try changing the filter tabs or generate new tickets.</p>
    </div>

    <!-- CONTENT: LIST VIEW -->
    <div *ngIf="!loading && schedules.length > 0 && viewMode === 'list'"
        class="border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-50 border-b border-gray-100">
                    <th class="p-4 pl-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest w-24">Date</th>
                    <th class="p-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest">Asset Details</th>
                    <th class="p-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest">Status</th>
                    <th class="p-4 pr-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest text-right">
                        Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
                <tr *ngFor="let item of schedules" class="group hover:bg-gray-50/50 transition-colors">
                    <td class="p-4 pl-6">
                        <div
                            class="flex flex-col items-center justify-center w-12 h-12 rounded-lg border border-gray-100 bg-white text-gray-700">
                            <span class="text-[10px] font-bold uppercase leading-none">{{ item.scheduled_date |
                                date:'MMM' }}</span>
                            <span class="text-lg font-bold leading-none mt-0.5">{{ item.scheduled_date | date:'dd'
                                }}</span>
                        </div>
                    </td>
                    <td class="p-4">
                        <p class="font-bold text-sm text-gray-900">{{ item.assets?.name }}</p>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span
                                class="text-[10px] font-bold px-1.5 py-0.5 rounded bg-gray-100 text-gray-500 uppercase tracking-wide">{{
                                item.assets?.location }}</span>
                            <span class="text-[10px] text-gray-400">{{ item.assets?.sku }}</span>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="px-2.5 py-1 rounded text-[10px] font-bold uppercase tracking-wide border"
                            [ngClass]="getStatusColor(item.status)">
                            {{ item.status.replace('_', ' ') }}
                        </span>
                    </td>
                    <td class="p-4 pr-6 text-right">
                        <button *ngIf="item.status !== 'completed'" (click)="markComplete(item.id!)"
                            class="inline-flex items-center px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600 text-xs font-bold transition-all shadow-sm">
                            Complete
                        </button>
                        <a *ngIf="item.ticket_id" [routerLink]="['/admin/tickets']" [queryParams]="{id: item.ticket_id}"
                            class="inline-flex ml-2 items-center px-3 py-1.5 rounded-lg bg-white border border-gray-200 text-gray-600 hover:border-blue-500 hover:text-blue-600 text-xs font-bold transition-all shadow-sm">
                            View Ticket
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- CONTENT: TIMELINE VIEW (GANTT) -->
    <div *ngIf="!loading && schedules.length > 0 && viewMode === 'timeline'"
        class="border border-gray-200 rounded-xl bg-white shadow-sm overflow-hidden flex flex-col">

        <!-- Timeline Header -->
        <div class="p-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button (click)="changeMonth(-1)" class="p-1 hover:bg-gray-200 rounded transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                        stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h3 class="text-sm font-black text-gray-900 uppercase tracking-widest w-32 text-center">
                    {{ timelineMonth | date:'MMMM yyyy' }}
                </h3>
                <button (click)="changeMonth(1)" class="p-1 hover:bg-gray-200 rounded transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                        stroke-width="2" viewBox="0 0 24 24">
                        <path d="M9 18l6-6-6-6" />
                    </svg>
                </button>
            </div>

            <div class="flex items-center gap-4 text-[10px] font-bold uppercase tracking-wide text-gray-500">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded bg-blue-500"></div>Scheduled
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded bg-green-500"></div>Completed
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded bg-red-500"></div>Missed
                </div>
            </div>
        </div>

        <!-- Timeline Grid Container -->
        <div class="overflow-x-auto">
            <div class="inline-block min-w-full">
                <!-- Grid Header (Days) -->
                <div class="flex border-b border-gray-100">
                    <div
                        class="w-48 flex-shrink-0 p-3 bg-white border-r border-gray-100 sticky left-0 z-10 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                        Asset</div>
                    <div *ngFor="let day of timelineDays"
                        class="w-10 flex-shrink-0 border-r border-gray-50 p-2 text-center">
                        <p class="text-[10px] font-bold text-gray-500 uppercase">{{ day | date:'EEE' }}</p>
                        <p class="text-xs font-bold text-gray-900">{{ day | date:'dd' }}</p>
                    </div>
                </div>

                <!-- Grid Body (Rows) -->
                <div *ngFor="let asset of uniqueAssets"
                    class="flex border-b border-gray-50 hover:bg-gray-50/50 transition-colors">
                    <div class="w-48 flex-shrink-0 p-3 bg-white border-r border-gray-100 sticky left-0 z-10">
                        <p class="text-xs font-bold text-gray-900 truncate">{{ asset?.name }}</p>
                        <p class="text-[10px] text-gray-400 truncate">{{ asset?.location }}</p>
                    </div>
                    <!-- Cells -->
                    <div *ngFor="let day of timelineDays"
                        class="w-10 flex-shrink-0 border-r border-gray-50 relative h-12">
                        <!-- Find if schedule exists for this asset/day -->
                        <ng-container *ngIf="getScheduleForDay(asset.id, day) as schedule">
                            <div class="absolute inset-1 rounded-md cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center group relative"
                                [title]="schedule.status" [ngClass]="{
                                    'bg-blue-500 shadow-sm shadow-blue-200': schedule.status === 'scheduled',
                                    'bg-green-500 shadow-sm shadow-green-200': schedule.status === 'completed',
                                    'bg-red-500 shadow-sm shadow-red-200': schedule.status === 'missed',
                                    'bg-yellow-500 shadow-sm shadow-yellow-200': schedule.status === 'in_progress'
                                }">
                                <!-- Tooltip -->
                                <div
                                    class="hidden group-hover:block absolute bottom-full mb-2 bg-gray-900 text-white text-[10px] px-2 py-1 rounded shadow-lg whitespace-nowrap z-20">
                                    {{ schedule.status }} | {{ schedule.scheduled_date | date:'dd MMM' }}
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>